
{% include 'healthierhabits/base_start.html' %}

{% include 'healthierhabits/orders/base_start.html' %}


<blockquote>

  <h1>Healthier Habits</h1>

  <h2>Add an Order</h2>

</blockquote>


<br>
<br>

<form action="add_action" method="post">

  {% csrf_token %}

  <table border="0" width="80%">

    <tr>
      <td align="right" width="150">
	<label>Customer:&nbsp;&nbsp;</label>
      </td><td>

	<select name="customer" id="cust_sel" onchange="getrewards()">
	  {% for customer in all_customers %}

	  <option value="{{ customer.id }}">
	    {{ customer.name_string }}</option>

	{% endfor %}
	</select>

      </td>
    </tr>


    <tr>
      <td align="right">
	<label>Item:&nbsp;&nbsp;</label>
      </td><td>

	<select name="item" id="item" onchange="show_price()">
<!--
	  <option value="{{ customer.id }}">
	    &nbsp;</option>
  -->	  
	</select>

      </td>
    </tr>

    <tr>
      <td align="right">
	<label>Price:&nbsp;&nbsp;</label>
      </td><td>
	<div id="price"></div
      </td>
    </tr>


    <tr><td>&nbsp;</td><td>&nbsp;</td></tr>

    <tr>
      <td>
	&nbsp;
      </td><td>
	<input type="submit" value="Add Order" />
      </td>
    </tr>

  </table>

</form>


<script>
<!--

  var xmlhttp = new XMLHttpRequest();
  var url;
  var rewards_array;

  xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        rewards_array = JSON.parse(xmlhttp.responseText);
        load_rewards();
    }
  };

  function getrewards()  {
    url = "../get_rewards_for_customer/?cid=";
    url += document.getElementById( "cust_sel").value ;
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
  }

  function load_rewards()  {
    var buf = "";
    var i, l;
    l = rewards_array.length;
    for( i = 0; i < l; i++)  {
      buf += '    <option value="' + rewards_array[i].id;
      buf += '" data-price="' + rewards_array[i].price + '">\n';
      buf += '      ' + rewards_array[i].name + ' - ';
      buf += rewards_array[i].price + ' pts</option>\n';
    }
    document.getElementById( "item").innerHTML = buf;
    show_price();
  }

  function show_price()  {
    var i, l, price;
    item = document.getElementById( "item").value;
    price = 0;
    l = rewards_array.length;
    for( i = 0; i < l; i++)  {
      if ( rewards_array[i].id == item)
        price = rewards_array[i].price;
    }
    document.getElementById( "price").innerHTML = price + " points";
  }


  getrewards();


  -->
</script>




  {% include 'healthierhabits/orders/base_finish.html' %}

  {% include 'healthierhabits/base_finish.html' %}

